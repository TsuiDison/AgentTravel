# 多智能体协作配送系统

一个基于 Python 的智能配送系统仿真平台，支持无人机、汽车和机器狗三种载具的协作配送任务规划与执行。

## 系统概述

本系统模拟真实世界的配送场景，通过智能算法为不同类型的载具分配最适合的配送任务，并实时可视化配送过程。系统考虑了地形、天气、载具能力等多种因素，提供了完整的配送解决方案。

## 核心功能

- **多载具支持**: 无人机、汽车、机器狗三种载具，各具特色
- **智能任务分配**: 基于载具能力和任务需求的最优匹配算法
- **路径规划**: A*算法实现的智能路径规划
- **实时可视化**: 基于 Matplotlib 的动态仿真界面
- **地形模拟**: 支持多种地形类型和障碍物
- **天气影响**: 模拟不同天气条件对配送的影响

## 系统架构

### 核心类结构

```
系统架构图
├── Map                          # 地图系统
│   ├── 地形生成 (_generate_terrain)
│   ├── 河流生成 (_generate_rivers)
│   ├── 道路网络 (_generate_roads)
│   ├── 建筑物生成 (_generate_buildings)
│   └── 障碍物生成 (_generate_obstacles)
│
├── Vehicle (基类)               # 载具基类
│   ├── Drone                   # 无人机
│   ├── Car                     # 汽车
│   └── RobotDog               # 机器狗
│
├── DeliveryTask                # 配送任务
│   └── 任务属性 (重量、时间窗口、紧急程度等)
│
├── CollaborativeDeliverySystem # 协作配送系统
│   ├── 载具选择器 (vehicle_selector)
│   ├── 任务分配 (assign_tasks)
│   └── 配送执行 (execute_delivery)
│
└── DeliveryVisualizer          # 可视化系统
    ├── GUI界面
    ├── 地图渲染
    └── 动画更新
```

### 主要模块

#### 1. 地图系统 (`Map`)
- **地形生成**: 使用中点位移算法生成真实地形
- **基础设施**: 自动生成道路网络、河流、建筑物
- **天气系统**: 支持晴天、雨天、大风、暴风雨等天气条件
- **地形类型**: 普通、陡峭、狭窄、丘陵、水域、道路

#### 2. 载具系统 (`Vehicle`)

**无人机 (`Drone`)**
- 三维飞行能力
- 高度限制: 5-20 单位
- 速度: 15 单位/步 (最大)
- 载重: 5kg
- 特点: 可跨越所有地形，受天气影响较大

**汽车 (`Car`)**
- 道路行驶限制
- 速度: 5 单位/步 (最大)
- 载重: 100kg
- 特点: 载重大，成本低，但受道路限制

**机器狗 (`RobotDog`)**
- 全地形适应性
- 速度: 7 单位/步 (最大)
- 载重: 20kg
- 特点: 可攀爬小障碍，地形适应性强

#### 3. 任务系统 (`DeliveryTask`)
支持的任务属性：
- 重量限制
- 体积限制
- 时间窗口
- 安全需求
- 紧急程度
- 成本限制
- 可扩展性
- 货物类型

#### 4. 智能分配系统 (`CollaborativeDeliverySystem`)
- **载具选择算法**: 基于多因素评分的最优载具选择
- **任务队列管理**: 支持并发任务处理
- **路径规划**: A*算法实现最优路径搜索
- **执行监控**: 实时跟踪任务执行状态

#### 5. 可视化系统 (`DeliveryVisualizer`)
- **交互式GUI**: 基于 Tkinter 的用户界面
- **实时动画**: 载具移动和任务执行的动态显示
- **参数控制**: 天气条件、任务参数的实时调整
- **反馈系统**: 实时显示系统状态和执行日志

## 安装要求

```bash
pip install numpy matplotlib tkinter threading queue math time copy random
```

### 依赖说明
- `numpy`: 数值计算和数组操作
- `matplotlib`: 图形绘制和动画
- `tkinter`: GUI界面
- 其他为 Python 标准库

## 使用方法

### 运行系统
```bash
python main.py
```

### 界面操作
1. **天气控制**: 在左侧面板选择天气条件
2. **任务创建**: 
   - 设置起点和终点坐标
   - 配置任务参数(重量、时间窗口等)
   - 点击"创建任务"按钮
3. **实时监控**: 在右侧反馈区域查看系统状态

### 任务参数说明
- **起点/终点**: 地图坐标 (0-100范围)
- **重量限制**: 货物重量 (kg)
- **时间窗口**: 完成时间限制 (时间单位)
- **紧急程度**: 1-5级 (数字越大越紧急)
- **安全需求**: 1-5级 (数字越大要求越高)
- **成本限制**: 最大允许成本
- **货物类型**: normal/fragile (普通/易碎品)

## 算法详解

### 载具选择算法
系统采用多因素评分机制：

```python
总分 = 紧急程度分数 × 0.4 + 安全分数 × 0.3 + 成本分数 × 0.3
```

评估因素：
- 载重能力匹配
- 时间窗口满足度
- 地形适应性
- 成本效益
- 安全性要求

### A*路径规划
- **启发函数**: 欧几里得距离
- **成本函数**: 考虑地形难度和天气影响
- **约束条件**: 载具特定的移动限制

## 扩展性

### 添加新载具类型
```python
class NewVehicle(Vehicle):
    def __init__(self, start_pos, goal_pos):
        super().__init__(start_pos, goal_pos)
        # 设置载具特定属性
        self.special_ability = True
```

### 添加新地形类型
在 `Map` 类的 `terrain_types` 字典中添加新类型，并更新相关方法。

### 扩展任务属性
在 `DeliveryTask` 类的 `attributes` 字典中添加新属性。

## 性能特点

- **实时处理**: 支持动态任务添加和处理
- **并发执行**: 多线程任务分配和执行
- **平滑动画**: 60fps 动画更新频率
- **内存优化**: 路径插值减少内存占用

## 故障排除

### 常见问题
1. **载具无法移动**: 检查起点终点是否在有效范围内
2. **路径规划失败**: 确认目标位置可达
3. **动画卡顿**: 减少并发任务数量
4. **中文显示异常**: 确保系统支持中文字体

### 调试模式
系统提供详细的日志输出，可在反馈区域查看详细错误信息。

## 贡献指南

欢迎提交 Issue 和 Pull Request 来改进系统功能。

## 许可证

MIT License - 详见 LICENSE 文件

## 联系方式

如有问题或建议，请通过 GitHub Issues 联系。